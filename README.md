# Allocator-Demo
Allocator Demo (malloc -> brk -> page Table -> write)


### Terminal 1:
```bash
TEACH_PAUSE_MS=1500 ./alloc
```

### Terminal 2:
```bash
cat /proc/$(pidof alloc)/maps | grep -E '\[heap\]|\s00:00\s0'
```

<br>

## Sample Output:
```txt
TEACH_PAUSE_MS=1500 ./alloc === Teaching Allocator Demo === PID=933 PAGE_SIZE=4096 [INIT ] program break start = 0x560fe38ed000 [MAPS] --- /proc/self/maps (key anonymous + heap lines) --- 560fe38cc000-560fe38ed000 rw-p 00000000 00:00 0 [heap] 7f61a033f000-7f61a0342000 rw-p 00000000 00:00 0 7f61a055e000-7f61a056b000 rw-p 00000000 00:00 0 7f61a0579000-7f61a057b000 rw-p 00000000 00:00 0 7ffdbb182000-7ffdbb1a4000 rw-p 00000000 00:00 0 [stack] 7ffdbb1ba000-7ffdbb1be000 r--p 00000000 00:00 0 [vvar] 7ffdbb1be000-7ffdbb1c0000 r-xp 00000000 00:00 0 [vdso] [MAPS] ------------------------------------------------ [MALLOC] small request=2000 aligned=2000 [SBRK] before brk=0x560fe38ed000 (heap size so far: 0 bytes) [ALLOC] no fit found → request from OS [OS] sbrk asked=8192 (≈2 pages) old_brk=0x560fe38ed000 new_brk=0x560fe38ef000 [SPLIT] block 0x560fe38ed000 -> used 2000, new free 0x560fe38ed7e8 (6128) [ALLOC] serve 2000 bytes at 0x560fe38ed018 (header=0x560fe38ed000 size=2000) [SBRK] after brk=0x560fe38ef000 (heap size so far: 8192 bytes) [WRITE] set 32 bytes at 0x560fe38ed018 to 0xaa [READ ] first 16 bytes: aa aa aa aa aa aa aa aa aa aa aa aa aa aa aa aa [MALLOC] small request=6000 aligned=6000 [SBRK] before brk=0x560fe38ef000 (heap size so far: 8192 bytes) [SPLIT] block 0x560fe38ed7e8 -> used 6000, new free 0x560fe38eef70 (96) [ALLOC] serve 6000 bytes at 0x560fe38ed800 (header=0x560fe38ed7e8 size=6000) [SBRK] after brk=0x560fe38ef000 (heap size so far: 8192 bytes) [WRITE] set 32 bytes at 0x560fe38ed800 to 0xbb [READ ] first 16 bytes: bb bb bb bb bb bb bb bb bb bb bb bb bb bb bb bb [MAPS] --- /proc/self/maps (key anonymous + heap lines) --- 560fe38cc000-560fe38ef000 rw-p 00000000 00:00 0 [heap] 7f61a033f000-7f61a0342000 rw-p 00000000 00:00 0 7f61a055e000-7f61a056b000 rw-p 00000000 00:00 0 7f61a0579000-7f61a057b000 rw-p 00000000 00:00 0 7ffdbb182000-7ffdbb1a4000 rw-p 00000000 00:00 0 [stack] 7ffdbb1ba000-7ffdbb1be000 r--p 00000000 00:00 0 [vvar] 7ffdbb1be000-7ffdbb1c0000 r-xp 00000000 00:00 0 [vdso] [MAPS] ------------------------------------------------ [FREE ] small at 0x560fe38ed018 (header 0x560fe38ed000 size=2000) [MALLOC] small request=1000 aligned=1008 [SBRK] before brk=0x560fe38ef000 (heap size so far: 8192 bytes) [SPLIT] block 0x560fe38ed000 -> used 1008, new free 0x560fe38ed408 (960) [ALLOC] serve 1008 bytes at 0x560fe38ed018 (header=0x560fe38ed000 size=1008) [SBRK] after brk=0x560fe38ef000 (heap size so far: 8192 bytes) [WRITE] set 16 bytes at 0x560fe38ed018 to 0xcc [READ ] first 16 bytes: cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc [MAPS] --- /proc/self/maps (key anonymous + heap lines) --- 560fe38cc000-560fe38ef000 rw-p 00000000 00:00 0 [heap] 7f61a033f000-7f61a0342000 rw-p 00000000 00:00 0 7f61a055e000-7f61a056b000 rw-p 00000000 00:00 0 7f61a0579000-7f61a057b000 rw-p 00000000 00:00 0 7ffdbb182000-7ffdbb1a4000 rw-p 00000000 00:00 0 [stack] 7ffdbb1ba000-7ffdbb1be000 r--p 00000000 00:00 0 [vvar] 7ffdbb1be000-7ffdbb1c0000 r-xp 00000000 00:00 0 [vdso] [MAPS] ------------------------------------------------ [MALLOC] LARGE request=2097152 aligned=2097152 via mmap() [MMAP ] got 2097152 bytes at 0x7f61a013f000 (own VM region) [WRITE] set 64 bytes at 0x7f61a013f000 to 0xdd [READ ] first 16 bytes: dd dd dd dd dd dd dd dd dd dd dd dd dd dd dd dd [MAPS] --- /proc/self/maps (key anonymous + heap lines) --- 560fe38cc000-560fe38ef000 rw-p 00000000 00:00 0 [heap] 7f61a013f000-7f61a0342000 rw-p 00000000 00:00 0 7f61a055e000-7f61a056b000 rw-p 00000000 00:00 0 7f61a0579000-7f61a057b000 rw-p 00000000 00:00 0 7ffdbb182000-7ffdbb1a4000 rw-p 00000000 00:00 0 [stack] 7ffdbb1ba000-7ffdbb1be000 r--p 00000000 00:00 0 [vvar] 7ffdbb1be000-7ffdbb1c0000 r-xp 00000000 00:00 0 [vdso] [MAPS] ------------------------------------------------ [FREE ] small at 0x560fe38ed800 (header 0x560fe38ed7e8 size=6000) [COAL ] merge 0x560fe38ed7e8 (6000) + 0x560fe38eef70 (96) [FREE ] small at 0x560fe38ed018 (header 0x560fe38ed000 size=1008) [COAL ] merge 0x560fe38ed000 (1008) + 0x560fe38ed408 (960) [COAL ] merge 0x560fe38ed000 (2000) + 0x560fe38ed7e8 (6128) [MUNMAP] released 2097152 bytes at 0x7f61a013f000 [MAPS] --- /proc/self/maps (key anonymous + heap lines) --- 560fe38cc000-560fe38ef000 rw-p 00000000 00:00 0 [heap] 7f61a033f000-7f61a0342000 rw-p 00000000 00:00 0 7f61a055e000-7f61a056b000 rw-p 00000000 00:00 0 7f61a0579000-7f61a057b000 rw-p 00000000 00:00 0 7ffdbb182000-7ffdbb1a4000 rw-p 00000000 00:00 0 [stack] 7ffdbb1ba000-7ffdbb1be000 r--p 00000000 00:00 0 [vvar] 7ffdbb1be000-7ffdbb1c0000 r-xp 00000000 00:00 0 [vdso] [MAPS] ------------------------------------------------ [END ] done. Inspect the logs above and /proc/self/maps output.
```
